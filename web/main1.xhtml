<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./WEB-INF/templates/layout.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core">

    <ui:define name="title">
        <title>Sistema FerreAsesorServer</title>
    </ui:define>

    <ui:define name="content">
         <p:fieldset>
            <f:facet name="legend">
                <h3>
                    <h:outputText value="Consultar Llamadas por Tiendas"/>
                </h3>
            </f:facet>

            <h:form id="formTotalLlamada"><br/>
                <h:panelGrid columns="2" style="margin-bottom: 10px;" id="selectTienda">
                    <h:outputText value="Consultar: " />  
                    <p:selectManyCheckbox value="#{llamadasConnectionBean.selectedTiendas}" >  
                        <f:selectItems value="#{llamadasConnectionBean.tiendas}" /> 
                    </p:selectManyCheckbox> 
                </h:panelGrid>
                <h:panelGrid columns="2" style="margin-bottom: 10px;">
                    <h:outputText value="Consultar: " />  
                    <p:selectManyCheckbox value="#{llamadasConnectionBean.selectedAllTiendas}">  
                        <f:selectItems value="#{llamadasConnectionBean.allTiendas}" /> 
                    </p:selectManyCheckbox> 
                </h:panelGrid>
                <h:panelGrid columns="8">
                    <h:outputLabel value="Fecha inicio: " for="fechaInicio"/>
                    <p:calendar id="fechaInicio" value="#{llamadasConnectionBean.fechaInicio}" 
                                showOn="button" pattern="dd/MM/yyyy"/>
                    <h:outputLabel value="Fecha fin: " for="fechaFin"/>
                    <p:calendar id="fechaFin" value="#{llamadasConnectionBean.fechaFin}" 
                                showOn="button" pattern="dd/MM/yyyy"/>
                    <p:spacer height="15"/>
                    <p:commandButton value="Obtener Datos"  actionListener="#{llamadasConnectionBean.obtenerListLlamadas}" ajax="true" update="formTotalLlamada"/>
                    <p:spacer style="width: 10px;"/>
                </h:panelGrid>
                <br/>
                <p:ajaxStatus style="right:45%; left:45%">  
                    <f:facet name="start">  
                        <h:graphicImage library="images" name="ajax-loader.gif" style="margin-top: 10px; margin-bottom: 0px; margin-left: 40%;margin-right: 45%"/>
                    </f:facet>  
                    <f:facet name="complete">  
                        <h:outputText value="" />  
                    </f:facet>  
                </p:ajaxStatus>
                <br/>
                <p:dataTable value="#{llamadasConnectionBean.listaLlamadas}" var="item" style="width: 60%; margin-top: 15px;" 
                             rendered="#{llamadasConnectionBean.showTable}">
                    <p:column headerText="Sucursal" width="15%" style="text-align: center;" filterBy="#{item.tiendaId.nombre}" filterMatchMode="contains">
                        <h:outputText value="#{item.tiendaId.nombre}"/>
                    </p:column>
                    <p:column headerText="Fecha" width="15%" style="text-align: center;" filterBy="#{item.fechaOpen}" filterMatchMode="contains">
                        <h:outputText value="#{item.fechaOpen}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>

                    <!-- <p:column headerText="Hora Inicio" width="15%" style="text-align: center;" filterBy="#{item.horaOpen}" filterMatchMode="contains">
                        <h:outputText value="#{item.horaOpen}">
                            <f:convertDateTime pattern="hh:mm:ss"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Hora Fin" width="15%" style="text-align: center;" filterBy="#{item.horaClose}" filterMatchMode="contains">
                        <h:outputText value="#{item.horaClose}">
                            <f:convertDateTime pattern="hh:mm:ss"/>
                        </h:outputText>
                    </p:column>-->

                    <p:column headerText="Turno" width="15%" style="text-align: center;" filterBy="#{item.turno}" filterMatchMode="contains">
                        <h:outputText value="#{item.turno}"/>
                    </p:column>
                    <p:column headerText="Dispositivo" width="15%" style="text-align: center;" filterBy="#{item.dispositivo}" filterMatchMode="contains">
                        <h:outputText value="#{item.dispositivo}"/>
                    </p:column>
                    <p:column headerText="Asesor" width="15%" style="text-align: center;" filterBy="#{item.asesor}" filterMatchMode="contains">
                        <h:outputText value="#{item.asesor}"/>
                    </p:column>
                    <p:column headerText="Calidad" width="15%" style="text-align: center;" filterBy="#{item.calidad}" filterMatchMode="contains">
                        <h:outputText value="#{item.calidad}"/>
                    </p:column>
                    <p:column headerText="Tiempo" width="15%" style="text-align: center;" filterBy="#{item.tiempo}" filterMatchMode="contains">
                        <h:outputText value="#{item.tiempo}"/>
                    </p:column>
                    <p:column headerText="N / F" width="15%" style="text-align: center;" filterBy="#{item.feriado}" filterMatchMode="contains">
                        <h:outputText value="#{item.feriado}"/>
                    </p:column>
                </p:dataTable>        
                
                <h:panelGroup id="messageTotalLlamada" layout="block">
                    <h:messages errorStyle="color: red" infoStyle="color: green" layout="table"/>
                </h:panelGroup>
            </h:form>
             
             <h:form id="formUpdate">
                 <h:outputText value="Actualizando Llamadas"/>
                 <p:poll interval="25" listener="#{llamadasUpdateBean.updateLlamadas}" update="formUpdate" />  
             </h:form>
             

        </p:fieldset>

    </ui:define>


</ui:composition>

